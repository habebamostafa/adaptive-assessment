<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام التقييم التكيفي - التعلم المعزز</title>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --success: #4cc9f0;
            --danger: #f72585;
            --warning: #fca311;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fb;
            color: var(--dark);
            line-height: 1.6;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1rem 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .nav-links {
            display: flex;
            list-style: none;
        }
        
        .nav-links li {
            margin-left: 1.5rem;
        }
        
        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: opacity 0.3s;
        }
        
        .nav-links a:hover {
            opacity: 0.8;
        }
        
        .btn {
            display: inline-block;
            padding: 0.5rem 1.5rem;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            text-decoration: none;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--secondary);
        }
        
        .btn-success {
            background-color: var(--success);
            color: white;
        }
        
        .btn-danger {
            background-color: var(--danger);
            color: white;
        }
        
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .card-title {
            font-size: 1.25rem;
            margin-bottom: 1rem;
            color: var(--primary);
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        .form-select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            background-color: white;
        }
        
        .page {
            display: none;
            padding: 2rem 0;
        }
        
        .active-page {
            display: block;
        }
        
        .assessment-container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .question-card {
            margin-bottom: 1.5rem;
        }
        
        .question-text {
            font-size: 1.2rem;
            margin-bottom: 1.5rem;
        }
        
        .options-list {
            list-style: none;
        }
        
        .option-item {
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .option-item:hover {
            background-color: #f0f0f0;
        }
        
        .option-item.selected {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .progress-container {
            margin-bottom: 1.5rem;
        }
        
        .progress-bar {
            height: 10px;
            background-color: #e9ecef;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background-color: var(--primary);
            border-radius: 5px;
            transition: width 0.3s;
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .stat-card {
            text-align: center;
            padding: 1.5rem;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
        }
        
        .stat-label {
            color: var(--gray);
        }
        
        .history-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .history-table th,
        .history-table td {
            padding: 0.75rem;
            text-align: right;
            border-bottom: 1px solid #ddd;
        }
        
        .history-table th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        
        .track-card {
            text-align: center;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .track-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .track-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--primary);
        }
        
        .recommendation-card {
            border-left: 4px solid var(--primary);
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .adaptive-indicator {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
            padding: 0.5rem;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
        
        .adaptive-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 0.5rem;
        }
        
        .badge-easy {
            background-color: var(--success);
            color: white;
        }
        
        .badge-medium {
            background-color: var(--warning);
            color: white;
        }
        
        .badge-hard {
            background-color: var(--danger);
            color: white;
        }
        
        .agent-feedback {
            margin-top: 1rem;
            padding: 1rem;
            background-color: #f8f9fa;
            border-radius: 4px;
            border-left: 4px solid var(--primary);
        }
        
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }
            
            .stats-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <nav>
                <div class="logo">نظام التقييم التكيفي</div>
                <ul class="nav-links">
                    <li><a href="#" onclick="showPage('home')">الرئيسية</a></li>
                    <li><a href="#" onclick="showPage('assessment')">التقييم</a></li>
                    <li><a href="#" onclick="showPage('history')">سجل التقييمات</a></li>
                    <li><a href="#" onclick="showPage('recommendations')">التوصيات</a></li>
                    <li><a href="#" onclick="logout()">تسجيل الخروج</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="container">
        <!-- صفحة تسجيل الدخول -->
        <section id="login-page" class="page active-page">
            <div class="card" style="max-width: 500px; margin: 2rem auto;">
                <h2 class="card-title">تسجيل الدخول</h2>
                <form id="login-form">
                    <div class="form-group">
                        <label for="login-email" class="form-label">البريد الإلكتروني</label>
                        <input type="email" id="login-email" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password" class="form-label">كلمة المرور</label>
                        <input type="password" id="login-password" class="form-control" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">تسجيل الدخول</button>
                </form>
                <p style="text-align: center; margin-top: 1rem;">
                    ليس لديك حساب؟ <a href="#" onclick="showPage('register')">إنشاء حساب</a>
                </p>
            </div>
        </section>

        <!-- صفحة التسجيل -->
        <section id="register-page" class="page">
            <div class="card" style="max-width: 500px; margin: 2rem auto;">
                <h2 class="card-title">إنشاء حساب جديد</h2>
                <form id="register-form">
                    <div class="form-group">
                        <label for="register-name" class="form-label">الاسم الكامل</label>
                        <input type="text" id="register-name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="register-email" class="form-label">البريد الإلكتروني</label>
                        <input type="email" id="register-email" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="register-password" class="form-label">كلمة المرور</label>
                        <input type="password" id="register-password" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="register-role" class="form-label">الدور</label>
                        <select id="register-role" class="form-select" required>
                            <option value="student">طالب</option>
                            <option value="teacher">معلم</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="register-track" class="form-label">المسار التعليمي</label>
                        <select id="register-track" class="form-select" required>
                            <option value="web">تطوير الويب</option>
                            <option value="ai">الذكاء الاصطناعي</option>
                            <option value="cyber">الأمن السيبراني</option>
                            <option value="data">علم البيانات</option>
                            <option value="mobile">تطوير الموبايل</option>
                            <option value="devops">DevOps</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="register-style" class="form-label">أسلوب التعلم المفضل</label>
                        <select id="register-style" class="form-select" required>
                            <option value="visual">بصري</option>
                            <option value="auditory">سمعي</option>
                            <option value="kinesthetic">حركي</option>
                            <option value="reading">قراءة/كتابة</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">إنشاء حساب</button>
                </form>
                <p style="text-align: center; margin-top: 1rem;">
                    لديك حساب بالفعل؟ <a href="#" onclick="showPage('login')">تسجيل الدخول</a>
                </p>
            </div>
        </section>

        <!-- صفحة الرئيسية -->
        <section id="home-page" class="page">
            <div class="card">
                <h2 class="card-title">مرحباً بك في نظام التقييم التكيفي</h2>
                <p>هذا النظام يستخدم تقنيات التعلم المعزز لتقييم مستواك وتقديم تجربة تعلم مخصصة بناءً على أدائك.</p>
                
                <div class="stats-container" style="margin-top: 2rem;">
                    <div class="card stat-card">
                        <div class="stat-value" id="ability-value">0%</div>
                        <div class="stat-label">مستوى القدرة الحالي</div>
                    </div>
                    <div class="card stat-card">
                        <div class="stat-value" id="assessments-count">0</div>
                        <div class="stat-label">عدد التقييمات المكتملة</div>
                    </div>
                    <div class="card stat-card">
                        <div class="stat-value" id="accuracy-value">0%</div>
                        <div class="stat-label">معدل الدقة</div>
                    </div>
                </div>
                
                <h3 style="margin: 1.5rem 0 1rem;">مسارك الحالي: <span id="current-track">تطوير الويب</span></h3>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1.5rem;">
                    <div class="card track-card" onclick="startAssessment('web')">
                        <div class="track-icon">💻</div>
                        <h3>تطوير الويب</h3>
                        <p>HTML, CSS, JavaScript, React, Node.js</p>
                    </div>
                    <div class="card track-card" onclick="startAssessment('ai')">
                        <div class="track-icon">🤖</div>
                        <h3>الذكاء الاصطناعي</h3>
                        <p>Machine Learning, Deep Learning, NLP</p>
                    </div>
                    <div class="card track-card" onclick="startAssessment('cyber')">
                        <div class="track-icon">🔒</div>
                        <h3>الأمن السيبراني</h3>
                        <p>Network Security, Cryptography, Ethical Hacking</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- صفحة التقييم -->
        <section id="assessment-page" class="page">
            <div class="assessment-container">
                <div class="progress-container">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span>السؤال <span id="current-question">1</span> من <span id="total-questions">10</span></span>
                        <span>مستوى الصعوبة: <span id="difficulty-level">2</span></span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill" style="width: 10%;"></div>
                    </div>
                </div>
                
                <!-- مؤشر التكيف -->
                <div class="adaptive-indicator">
                    <span>استراتيجية التكيف:</span>
                    <span class="adaptive-badge" id="adaptation-strategy">تعلم معزز</span>
                    <span style="margin-right: auto;">ثقة النموذج:</span>
                    <span id="model-confidence">75%</span>
                </div>
                
                <div class="card question-card">
                    <h3 class="question-text" id="question-text">يتم تحميل السؤال...</h3>
                    <ul class="options-list" id="options-list">
                        <!-- سيتم ملء الخيارات ديناميكياً -->
                    </ul>
                </div>
                
                <!-- ملاحظات الوكيل -->
                <div class="agent-feedback" id="agent-feedback">
                    <strong>ملاحظات النظام:</strong>
                    <span id="feedback-text">يتم تحليل أدائك لتحديد السؤال التالي...</span>
                </div>
                
                <div style="display: flex; justify-content: space-between; margin-top: 1.5rem;">
                    <button class="btn btn-danger" onclick="cancelAssessment()">إلغاء التقييم</button>
                    <button class="btn btn-primary" id="next-button" onclick="submitAnswer()" disabled>إرسال الإجابة</button>
                </div>
            </div>
        </section>

        <!-- صفحة نتائج التقييم -->
        <section id="results-page" class="page">
            <div class="assessment-container">
                <div class="card">
                    <h2 class="card-title" style="text-align: center;">نتيجة التقييم</h2>
                    
                    <div class="stats-container">
                        <div class="card stat-card">
                            <div class="stat-value" id="result-score">0/0</div>
                            <div class="stat-label">الإجابات الصحيحة</div>
                        </div>
                        <div class="card stat-card">
                            <div class="stat-value" id="result-ability">0%</div>
                            <div class="stat-label">مستوى القدرة النهائي</div>
                        </div>
                        <div class="card stat-card">
                            <div class="stat-value" id="result-confidence">0%</div>
                            <div class="stat-label">مستوى الثقة</div>
                        </div>
                        <div class="card stat-card">
                            <div class="stat-value" id="result-level">0</div>
                            <div class="stat-label">المستوى الموصى به</div>
                        </div>
                    </div>
                    
                    <h3 style="margin: 1.5rem 0 1rem;">تحليل الأداء حسب المستوى</h3>
                    <div id="level-performance">
                        <!-- سيتم ملء تحليل الأداء ديناميكياً -->
                    </div>
                    
                    <!-- تحليل الوكيل -->
                    <h3 style="margin: 1.5rem 0 1rem;">تحليل نظام التعلم المعزز</h3>
                    <div class="agent-feedback">
                        <strong>ملخص أداء الوكيل:</strong>
                        <div id="agent-analysis">
                            <p>يتم تحليل بيانات التقييم...</p>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 2rem;">
                        <button class="btn btn-primary" onclick="showPage('home')">العودة إلى الرئيسية</button>
                        <button class="btn btn-success" onclick="viewRecommendations()">عرض التوصيات</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- صفحة سجل التقييمات -->
        <section id="history-page" class="page">
            <div class="card">
                <h2 class="card-title">سجل التقييمات</h2>
                
                <div class="table-responsive">
                    <table class="history-table">
                        <thead>
                            <tr>
                                <th>التاريخ</th>
                                <th>المسار</th>
                                <th>النتيجة</th>
                                <th>مستوى القدرة</th>
                                <th>المستوى الموصى به</th>
                                <th>استراتيجية التكيف</th>
                                <th>الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody id="history-table-body">
                            <!-- سيتم ملء سجل التقييمات ديناميكياً -->
                        </tbody>
                    </table>
                </div>
                
                <div id="no-history" style="text-align: center; padding: 2rem; display: none;">
                    <p>لا توجد تقييمات سابقة.</p>
                    <button class="btn btn-primary" onclick="showPage('assessment')">بدء التقييم الأول</button>
                </div>
            </div>
        </section>

        <!-- صفحة التوصيات -->
        <section id="recommendations-page" class="page">
            <div class="card">
                <h2 class="card-title">توصيات التعلم التكيفي</h2>
                
                <div class="stats-container">
                    <div class="card stat-card">
                        <div class="stat-value" id="rec-ability">0%</div>
                        <div class="stat-label">مستوى القدرة الحالي</div>
                    </div>
                    <div class="card stat-card">
                        <div class="stat-value" id="rec-difficulty">1</div>
                        <div class="stat-label">مستوى الصعوبة الموصى به</div>
                    </div>
                    <div class="card stat-card">
                        <div class="stat-value" id="rec-time">0 ساعة</div>
                        <div class="stat-label">الوقت المتوقع للإتقان</div>
                    </div>
                </div>
                
                <h3 style="margin: 1.5rem 0 1rem;">الدروس الموصى بها</h3>
                <div id="recommended-lessons">
                    <!-- سيتم ملء الدروس الموصى بها ديناميكياً -->
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-top: 1.5rem;">
                    <div>
                        <h3 style="margin-bottom: 1rem;">نقاط القوة</h3>
                        <div id="strengths-list">
                            <!-- سيتم ملء نقاط القوة ديناميكياً -->
                        </div>
                    </div>
                    <div>
                        <h3 style="margin-bottom: 1rem;">نقاط الضعف</h3>
                        <div id="weaknesses-list">
                            <!-- سيتم ملء نقاط الضعف ديناميكياً -->
                        </div>
                    </div>
                </div>
                
                <!-- توصيات الوكيل -->
                <h3 style="margin: 1.5rem 0 1rem;">توصيات نظام التعلم المعزز</h3>
                <div class="agent-feedback">
                    <div id="rl-recommendations">
                        <p>يتم إنشاء توصيات مخصصة بناءً على أدائك...</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>
        // المتغيرات العامة
        let currentUser = null;
        let currentSession = null;
        let currentQuestion = null;
        let selectedOption = null;
        let adaptationStrategy = "rl_based"; // استراتيجية التكيف الافتراضية
        
        // عناصر DOM
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        
        // معالجة أحداث النماذج
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            try {
                // محاكاة عملية تسجيل الدخول (في تطبيق حقيقي، سيتم التواصل مع الخادم)
                const mockUser = {
                    id: 'user_' + Date.now(),
                    name: 'مستخدم تجريبي',
                    email: email,
                    role: 'student',
                    learningProfile: {
                        currentAbility: 0.5,
                        track: 'web',
                        assessmentHistory: []
                    }
                };
                
                currentUser = mockUser;
                localStorage.setItem('currentUser', JSON.stringify(mockUser));
                showPage('home');
                loadUserData();
                
            } catch (error) {
                console.error('Login error:', error);
                alert('حدث خطأ أثناء تسجيل الدخول');
            }
        });
        
        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const role = document.getElementById('register-role').value;
            const track = document.getElementById('register-track').value;
            const preferredLearningStyle = document.getElementById('register-style').value;
            
            try {
                // محاكاة عملية التسجيل (في تطبيق حقيقي، سيتم التواصل مع الخادم)
                const mockUser = {
                    id: 'user_' + Date.now(),
                    name: name,
                    email: email,
                    role: role,
                    learningProfile: {
                        preferredLearningStyle: preferredLearningStyle,
                        track: track,
                        currentAbility: 0.5,
                        assessmentHistory: []
                    }
                };
                
                currentUser = mockUser;
                localStorage.setItem('currentUser', JSON.stringify(mockUser));
                alert('تم إنشاء الحساب بنجاح، يرجى تسجيل الدخول');
                showPage('login');
            } catch (error) {
                console.error('Registration error:', error);
                alert('حدث خطأ أثناء إنشاء الحساب');
            }
        });
        
        // وظائف التحكم في الصفحات
        function showPage(pageId) {
            // إخفاء جميع الصفحات
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active-page');
            });
            
            // إظهار الصفحة المطلوبة
            document.getElementById(`${pageId}-page`).classList.add('active-page');
            
            // تحميل البيانات عند الحاجة
            if (pageId === 'home' && currentUser) {
                loadUserData();
            } else if (pageId === 'history' && currentUser) {
                loadAssessmentHistory();
            } else if (pageId === 'recommendations' && currentUser) {
                loadRecommendations();
            }
        }
        
        // تحميل بيانات المستخدم
        async function loadUserData() {
            try {
                if (!currentUser) {
                    const savedUser = localStorage.getItem('currentUser');
                    if (savedUser) {
                        currentUser = JSON.parse(savedUser);
                    }
                }
                
                if (currentUser) {
                    // تحديث الإحصائيات
                    document.getElementById('ability-value').textContent = 
                        `${(currentUser.learningProfile.currentAbility * 100).toFixed(1)}%`;
                    document.getElementById('assessments-count').textContent = 
                        currentUser.learningProfile.assessmentHistory.length;
                    document.getElementById('accuracy-value').textContent = 
                        currentUser.learningProfile.assessmentHistory.length > 0 ? 
                        `${(currentUser.learningProfile.currentAbility * 100).toFixed(1)}%` : '0%';
                    document.getElementById('current-track').textContent = 
                        getTrackName(currentUser.learningProfile.track);
                }
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }
        
        // بدء التقييم
        async function startAssessment(track) {
            try {
                // محاكاة بدء التقييم (في تطبيق حقيقي، سيتم التواصل مع الخادم)
                currentSession = 'session_' + Date.now();
                
                // تحديد استراتيجية التكيف بناءً على المسار
                adaptationStrategy = track === 'ai' ? 'rl_advanced' : 'rl_based';
                document.getElementById('adaptation-strategy').textContent = 
                    adaptationStrategy === 'rl_advanced' ? 'تعلم معزز متقدم' : 'تعلم معزز';
                
                // الحصول على السؤال الأول
                const firstQuestion = await getNextQuestion(0.5, 2);
                
                showPage('assessment');
                loadQuestion(firstQuestion);
            } catch (error) {
                console.error('Error starting assessment:', error);
                alert('حدث خطأ أثناء بدء التقييم');
            }
        }
        
        // محاكاة الحصول على سؤال من النظام
        async function getNextQuestion(ability, currentLevel) {
            // محاكاة اتصال بنظام التعلم المعزز
            const difficulty = calculateDifficulty(ability, currentLevel);
            const question = generateAdaptiveQuestion(difficulty, currentUser.learningProfile.track);
            
            // تحديث مؤشر الثقة
            const confidence = 70 + Math.random() * 25; // ثقة بين 70% و 95%
            document.getElementById('model-confidence').textContent = `${confidence.toFixed(0)}%`;
            
            return question;
        }
        
        // حساب الصعوبة بناءً على القدرة والمستوى الحالي
        function calculateDifficulty(ability, currentLevel) {
            // خوارزمية تكيفية بسيطة
            if (ability > 0.7) return Math.min(3, currentLevel + 1);
            if (ability < 0.3) return Math.max(1, currentLevel - 1);
            return currentLevel;
        }
        
        // توليد سؤال تكيفي
        function generateAdaptiveQuestion(level, track) {
            const questions = {
                web: {
                    1: [
                        {
                            id: 'web_1_1',
                            text: "ما هي اللغة الأساسية لإنشاء هيكل صفحات الويب؟",
                            options: ["HTML", "Python", "Java", "C++"],
                            correct_answer: "HTML",
                            explanation: "HTML (لغة ترميز النص الفائق) هي اللغة الأساسية لإنشاء هيكل صفحات الويب."
                        },
                        {
                            id: 'web_1_2',
                            text: "ماذا يعني اختصار CSS؟",
                            options: ["أوراق الأنماط المتتالية", "أنماط تصميم الكمبيوتر", 
                                    "أنماط التصميم الإبداعية", "أنماط الألوان"],
                            correct_answer: "أوراق الأنماط المتتالية",
                            explanation: "CSS تعني Cascading Style Sheets وهي مسؤولة عن تنسيق وتصميم صفحات الويب."
                        }
                    ],
                    2: [
                        {
                            id: 'web_2_1',
                            text: "ما هو React؟",
                            options: ["مكتبة جافاسكريبت لواجهات المستخدم", "لغة برمجة", 
                                    "إطار عمل للخادم", "نظام قواعد بيانات"],
                            correct_answer: "مكتبة جافاسكريبت لواجهات المستخدم",
                            explanation: "React هي مكتبة جافاسكريبت مفتوحة المصدر لبناء واجهات المستخدم."
                        }
                    ],
                    3: [
                        {
                            id: 'web_3_1',
                            text: "ما هو الهدف من استخدام Webpack في تطوير الويب؟",
                            options: ["حزم وتجميع وحدات جافاسكريبت", "إدارة قواعد البيانات",
                                    "إنشاء أنماط التصميم", "برمجة الخادم"],
                            correct_answer: "حزم وتجميع وحدات جافاسكريبت",
                            explanation: "Webpack هو أداة تجميع وحدات تقوم بحزم موارد الويب مثل JavaScript والCSS."
                        }
                    ]
                },
                ai: {
                    1: [
                        {
                            id: 'ai_1_1',
                            text: "ما هي لغة البرمجة الأكثر شيوعاً في الذكاء الاصطناعي؟",
                            options: ["Python", "C#", "Ruby", "Go"],
                            correct_answer: "Python",
                            explanation: "بايثون هي اللغة الأكثر شيوعاً في الذكاء الاصطناعي بسبب مكتباتها الغنية وبساطتها."
                        }
                    ],
                    2: [
                        {
                            id: 'ai_2_1',
                            text: "ما هو التعلم الآلي (Machine Learning)؟",
                            options: ["تعليم الآلات التعلم من البيانات", "برمجة الروبوتات",
                                    "إنشاء مواقع الويب", "إدارة قواعد البيانات"],
                            correct_answer: "تعليم الآلات التعلم من البيانات",
                            explanation: "التعلم الآلي هو مجال من مجالات الذكاء الاصطناعي يسمح للأنظمة بالتعلم من البيانات دون برمجة صريحة."
                        }
                    ],
                    3: [
                        {
                            id: 'ai_3_1',
                            text: "ما هي الشبكات العصبية التلافيفية (CNN)؟",
                            options: ["نوع من الشبكات العصبية لمعالجة البيانات الشبكية مثل الصور", 
                                    "شبكة للتعامل مع البيانات النصية فقط",
                                    "نظام لإدارة قواعد البيانات",
                                    "لغة برمجة للذكاء الاصطناعي"],
                            correct_answer: "نوع من الشبكات العصبية لمعالجة البيانات الشبكية مثل الصور",
                            explanation: "الشبكات العصبية التلافيفية متخصصة في معالجة البيانات ذات البنية الشبكية مثل الصور."
                        }
                    ]
                },
                cyber: {
                    1: [
                        {
                            id: 'cyber_1_1',
                            text: "ما هو الهجوم الإلكتروني الأكثر شيوعاً؟",
                            options: ["التصيد (Phishing)", "حرمان الخدمة (DDoS)", 
                                    "رجل في المنتصف (MITM)", "هجوم الصفر يوم (Zero-day)"],
                            correct_answer: "التصيد (Phishing)",
                            explanation: "هجمات التصيد هي الأكثر شيوعاً حيث تعتمد على خداع المستخدمين لكشف معلومات حساسة."
                        }
                    ],
                    2: [
                        {
                            id: 'cyber_2_1',
                            text: "ما هو جدار الحماية (Firewall)؟",
                            options: ["نظام أمان للشبكات", "تخزين البيانات",
                                    "برنامج لإنشاء مواقع", "لغة برمجة"],
                            correct_answer: "نظام أمان للشبكات",
                            explanation: "جدار الحماية هو نظام أمان يراقب ويراقب حركة مرور الشبكة بناءً على قواعد أمان محددة."
                        }
                    ],
                    3: [
                        {
                            id: 'cyber_3_1',
                            text: "ما هو التشفير غير المتماثل (Asymmetric Encryption)؟",
                            options: ["نظام تشفير يستخدم زوجاً من المفاتيح: عام وخاص", 
                                    "تشفير يستخدم مفتاحاً واحداً",
                                    "نظام حماية من الفيروسات",
                                    "برنامج لإخفاء البيانات"],
                            correct_answer: "نظام تشفير يستخدم زوجاً من المفاتيح: عام وخاص",
                            explanation: "التشفير غير المتماثل يستخدم زوجاً من المفاتيح حيث يتم التشفير بالمفتاح العام وفك التشفير بالمفتاح الخاص."
                        }
                    ]
                }
            };
            
            // اختيار سؤال عشوائي من المستوى والمسار المحدد
            if (questions[track] && questions[track][level]) {
                const trackQuestions = questions[track][level];
                return trackQuestions[Math.floor(Math.random() * trackQuestions.length)];
            }
            
            // السؤال الافتراضي إذا لم يتم العثور على أسئلة للمستوى/المسار
            return {
                id: 'default_question',
                text: "ما هي لغة البرمجة الأكثر استخداماً في تطوير الويب؟",
                options: ["JavaScript", "Python", "Java", "C++"],
                correct_answer: "JavaScript",
                explanation: "جافاسكريبت هي اللغة الأكثر استخداماً في تطوير الويب، خاصةً للتفاعل في المتصفح.",
                level: level,
                track: track
            };
        }
        
        // تحميل السؤال
        function loadQuestion(questionData) {
            currentQuestion = questionData;
            
            document.getElementById('question-text').textContent = questionData.text;
            
            // تحديث مؤشر مستوى الصعوبة
            const difficultyText = {1: "سهل", 2: "متوسط", 3: "صعب"}[questionData.level] || questionData.level;
            document.getElementById('difficulty-level').textContent = difficultyText;
            
            // إضافة فئة CSS لمستوى الصعوبة
            const difficultyElement = document.getElementById('difficulty-level');
            difficultyElement.className = '';
            if (questionData.level === 1) difficultyElement.classList.add('badge-easy');
            else if (questionData.level === 2) difficultyElement.classList.add('badge-medium');
            else if (questionData.level === 3) difficultyElement.classList.add('badge-hard');
            
            const optionsList = document.getElementById('options-list');
            optionsList.innerHTML = '';
            
            questionData.options.forEach((option, index) => {
                const li = document.createElement('li');
                li.className = 'option-item';
                li.textContent = option;
                li.onclick = () => selectOption(index, li);
                optionsList.appendChild(li);
            });
            
            // تحديث شريط التقدم
            const progress = (currentQuestion.number / 10) * 100 || 10;
            document.getElementById('progress-fill').style.width = `${progress}%`;
            document.getElementById('current-question').textContent = currentQuestion.number || 1;
            document.getElementById('total-questions').textContent = 10;
            
            // تعطيل زر الإرسال حتى يتم اختيار إجابة
            document.getElementById('next-button').disabled = true;
            selectedOption = null;
            
            // تحديث ملاحظات الوكيل
            updateAgentFeedback(questionData.level);
        }
        
        // تحديث ملاحظات نظام التعلم المعزز
        function updateAgentFeedback(level) {
            const feedbackElement = document.getElementById('feedback-text');
            const feedbacks = {
                1: "هذا السؤال مناسب للمبتدئين. سيساعدنا في تقييم أساسياتك.",
                2: "هذا سؤال متوسط المستوى. سنقيم فهمك للمفاهيم المتوسطة.",
                3: "هذا سؤال متقدم. صمم لتحدي فهمك العميق للموضوع."
            };
            
            feedbackElement.textContent = feedbacks[level] || "يتم تحليل أدائك لتحديد السؤال المناسب التالي.";
        }
        
        // اختيار إجابة
        function selectOption(index, element) {
            // إلغاء تحديد جميع الخيارات
            document.querySelectorAll('.option-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // تحديد الخيار الحالي
            element.classList.add('selected');
            selectedOption = index;
            
            // تمكين زر الإرسال
            document.getElementById('next-button').disabled = false;
        }
        
        // إرسال الإجابة
        async function submitAnswer() {
            if (selectedOption === null) return;
            
            try {
                const selectedAnswer = currentQuestion.options[selectedOption];
                const isCorrect = selectedAnswer === currentQuestion.correct_answer;
                
                // تحديث قدرة الطالب بناءً على الإجابة
                const abilityChange = isCorrect ? 0.05 : -0.05;
                currentUser.learningProfile.currentAbility = Math.max(0.1, Math.min(0.99, 
                    currentUser.learningProfile.currentAbility + abilityChange));
                
                // حفظ التقييم في السجل
                if (!currentUser.learningProfile.assessmentHistory) {
                    currentUser.learningProfile.assessmentHistory = [];
                }
                
                // محاكاة الحصول على السؤال التالي
                const nextLevel = calculateDifficulty(currentUser.learningProfile.currentAbility, currentQuestion.level);
                const nextQuestion = await getNextQuestion(currentUser.learningProfile.currentAbility, nextLevel);
                nextQuestion.number = (currentQuestion.number || 1) + 1;
                
                if (nextQuestion.number > 10) {
                    // انتهاء التقييم بعد 10 أسئلة
                    completeAssessment();
                } else {
                    // تحميل السؤال التالي
                    loadQuestion(nextQuestion);
                }
                
            } catch (error) {
                console.error('Error submitting answer:', error);
                alert('حدث خطأ أثناء إرسال الإجابة');
            }
        }
        
        // إكمال التقييم وعرض النتائج
        function completeAssessment() {
            // حفظ جلسة التقييم
            const assessmentResult = {
                sessionId: currentSession,
                track: currentUser.learningProfile.track,
                date: new Date(),
                totalQuestions: 10,
                correctAnswers: Math.round(currentUser.learningProfile.currentAbility * 10),
                finalAbility: currentUser.learningProfile.currentAbility,
                confidenceScore: 0.8,
                recommendedLevel: Math.ceil(currentUser.learningProfile.currentAbility * 3)
            };
            
            currentUser.learningProfile.assessmentHistory.push(assessmentResult);
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            
            // عرض النتائج
            showResults(assessmentResult);
        }
        
        // إلغاء التقييم
        function cancelAssessment() {
            if (confirm('هل أنت متأكد من إلغاء التقييم؟ سيتم فقدان تقدمك الحالي.')) {
                showPage('home');
            }
        }
        
        // عرض النتائج
        function showResults(summary) {
            document.getElementById('result-score').textContent = 
                `${summary.correctAnswers}/${summary.totalQuestions}`;
            document.getElementById('result-ability').textContent = 
                `${(summary.finalAbility * 100).toFixed(1)}%`;
            document.getElementById('result-confidence').textContent = 
                `${(summary.confidenceScore * 100).toFixed(1)}%`;
            document.getElementById('result-level').textContent = summary.recommendedLevel;
            
            // عرض تحليل الأداء حسب المستوى
            const levelPerformance = document.getElementById('level-performance');
            levelPerformance.innerHTML = '';
            
            for (let level = 1; level <= 3; level++) {
                const questionsInLevel = Math.round(10 / 3);
                const correctInLevel = Math.round(summary.correctAnswers / 3);
                
                const div = document.createElement('div');
                div.className = 'recommendation-card';
                div.innerHTML = `
                    <h4>المستوى ${level}</h4>
                    <p>الدقة: ${(correctInLevel / questionsInLevel * 100).toFixed(1)}%</p>
                    <p>عدد الأسئلة: ${questionsInLevel}</p>
                `;
                levelPerformance.appendChild(div);
            }
            
            // عرض تحليل الوكيل
            const agentAnalysis = document.getElementById('agent-analysis');
            agentAnalysis.innerHTML = `
                <p>استخدم النظام استراتيجية <strong>${adaptationStrategy === 'rl_advanced' ? 'تعلم معزز متقدم' : 'تعلم معزز'}</strong></p>
                <p>تم تعديل صعوبة الأسئلة بناءً على أدائك في الوقت الحقيقي.</p>
                <p>مستوى القدرة النهائي: <strong>${(summary.finalAbility * 100).toFixed(1)}%</strong></p>
                <p>نوصي بالبدء بالمستوى <strong>${summary.recommendedLevel}</strong> في التقييم القادم.</p>
            `;
            
            showPage('results');
        }
        
        // تحميل سجل التقييمات
        async function loadAssessmentHistory() {
            try {
                if (!currentUser) {
                    const savedUser = localStorage.getItem('currentUser');
                    if (savedUser) {
                        currentUser = JSON.parse(savedUser);
                    }
                }
                
                const tbody = document.getElementById('history-table-body');
                tbody.innerHTML = '';
                
                if (!currentUser || !currentUser.learningProfile.assessmentHistory || 
                    currentUser.learningProfile.assessmentHistory.length === 0) {
                    document.getElementById('no-history').style.display = 'block';
                    return;
                }
                
                document.getElementById('no-history').style.display = 'none';
                
                currentUser.learningProfile.assessmentHistory.forEach(assessment => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${new Date(assessment.date).toLocaleDateString('ar-EG')}</td>
                        <td>${getTrackName(assessment.track)}</td>
                        <td>${assessment.correctAnswers}/${assessment.totalQuestions}</td>
                        <td>${(assessment.finalAbility * 100).toFixed(1)}%</td>
                        <td>${assessment.recommendedLevel}</td>
                        <td>${assessment.track === 'ai' ? 'تعلم معزز متقدم' : 'تعلم معزز'}</td>
                        <td>
                            <button class="btn btn-primary" onclick="viewAssessmentDetails('${assessment.sessionId}')">التفاصيل</button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            } catch (error) {
                console.error('Error loading assessment history:', error);
            }
        }
        
        // تحميل التوصيات
        async function loadRecommendations() {
            try {
                if (!currentUser) {
                    const savedUser = localStorage.getItem('currentUser');
                    if (savedUser) {
                        currentUser = JSON.parse(savedUser);
                    }
                }
                
                if (currentUser) {
                    document.getElementById('rec-ability').textContent = 
                        `${(currentUser.learningProfile.currentAbility * 100).toFixed(1)}%`;
                    document.getElementById('rec-difficulty').textContent = 
                        Math.ceil(currentUser.learningProfile.currentAbility * 3);
                    document.getElementById('rec-time').textContent = 
                        `${Math.round((1 - currentUser.learningProfile.currentAbility) * 20)} ساعة`;
                    
                    // عرض الدروس الموصى بها
                    const lessonsContainer = document.getElementById('recommended-lessons');
                    lessonsContainer.innerHTML = '';
                    
                    const recommendedLessons = generateRecommendedLessons(
                        currentUser.learningProfile.track, 
                        currentUser.learningProfile.currentAbility
                    );
                    
                    recommendedLessons.forEach(lesson => {
                        const div = document.createElement('div');
                        div.className = 'recommendation-card';
                        div.innerHTML = `
                            <h4>${lesson.title}</h4>
                            <p>${lesson.description}</p>
                            <p>المستوى: ${lesson.level} | الوقت المتوقع: ${lesson.duration} دقيقة</p>
                        `;
                        lessonsContainer.appendChild(div);
                    });
                    
                    // عرض نقاط القوة والضعف
                    const strengthsList = document.getElementById('strengths-list');
                    const weaknessesList = document.getElementById('weaknesses-list');
                    strengthsList.innerHTML = '';
                    weaknessesList.innerHTML = '';
                    
                    const { strengths, weaknesses } = generateStrengthsAndWeaknesses(
                        currentUser.learningProfile.track, 
                        currentUser.learningProfile.currentAbility
                    );
                    
                    strengths.forEach(strength => {
                        const p = document.createElement('p');
                        p.textContent = strength;
                        strengthsList.appendChild(p);
                    });
                    
                    weaknesses.forEach(weakness => {
                        const p = document.createElement('p');
                        p.textContent = weakness;
                        weaknessesList.appendChild(p);
                    });
                    
                    // عرض توصيات التعلم المعزز
                    const rlRecommendations = document.getElementById('rl-recommendations');
                    rlRecommendations.innerHTML = `
                        <p>بناءً على أدائك، يقترح نظام التعلم المعزز:</p>
                        <ul>
                            <li>التركيز على ${weaknesses[0] || 'المفاهيم المتوسطة'}</li>
                            <li>ممارسة ${Math.round((1 - currentUser.learningProfile.currentAbility) * 10)} تمارين إضافية</li>
                            <li>البدء بالمستوى ${Math.ceil(currentUser.learningProfile.currentAbility * 3)} في التقييم القادم</li>
                        </ul>
                    `;
                }
            } catch (error) {
                console.error('Error loading recommendations:', error);
            }
        }
        
        // توليد الدروس الموصى بها
        function generateRecommendedLessons(track, ability) {
            const lessons = {
                web: [
                    { title: "أساسيات HTML", description: "تعلم هيكلة صفحات الويب", level: 1, duration: 30 },
                    { title: "تنسيق الصفحات باستخدام CSS", description: "أساسيات التصميم والتنسيق", level: 1, duration: 45 },
                    { title: "البرمجة بلغة JavaScript", description: "أساسيات البرمجة بلغة JavaScript", level: 2, duration: 60 },
                    { title: "إطارات عمل JavaScript", description: "تعلم React و Vue", level: 3, duration: 90 },
                    { title: "برمجة الخادم باستخدام Node.js", description: "بناء تطبيقات الخادم", level: 3, duration: 120 }
                ],
                ai: [
                    { title: "مدخل إلى الذكاء الاصطناعي", description: "المفاهيم الأساسية للذكاء الاصطناعي", level: 1, duration: 40 },
                    { title: "أساسيات بايثون للذكاء الاصطناعي", description: "تعلم بايثون للتطبيقات الذكية", level: 1, duration: 50 },
                    { title: "التعلم الآلي الأساسي", description: "مقدمة في خوارزميات التعلم الآلي", level: 2, duration: 70 },
                    { title: "الشبكات العصبية", description: "مقدمة في الشبكات العصبية الاصطناعية", level: 3, duration: 100 },
                    { title: "التعلم العميق", description: "الغوص في عالم التعلم العميق", level: 3, duration: 120 }
                ],
                cyber: [
                    { title: "أساسيات الأمن السيبراني", description: "مقدمة في مفاهيم الأمن السيبراني", level: 1, duration: 35 },
                    { title: "أمن الشبكات", description: "حماية الشبكات من الاختراقات", level: 2, duration: 55 },
                    { title: "أخلاقيات الاختراق", description: "اختبار الاختراق الأخلاقي", level: 2, duration: 65 },
                    { title: "التشفير وأمن البيانات", description: "حماية البيانات through التشفير", level: 3, duration: 85 },
                    { title: "الدفاع المتقدم ضد التهديدات", description: "استراتيجيات متقدمة للحماية", level: 3, duration: 110 }
                ]
            };
            
            // ترشيح الدروس بناءً على مستوى القدرة
            const recommendedLevel = Math.ceil(ability * 3);
            return lessons[track].filter(lesson => lesson.level === recommendedLevel).slice(0, 3);
        }
        
        // توليد نقاط القوة والضعف
        function generateStrengthsAndWeaknesses(track, ability) {
            const allStrengths = {
                web: [
                    "فهم جيد لهيكلة HTML",
                    "مهارات جيدة في تنسيق CSS",
                    "قدرة على استخدام JavaScript للتفاعل",
                    "فهم أساسيات React",
                    "معرفة جيدة بتطوير الخادم"
                ],
                ai: [
                    "فهم أساسيات الذكاء الاصطناعي",
                    "مهارات جيدة في بايثون",
                    "قدرة على تطبيق خوارزميات التعلم الآلي",
                    "فهم الشبكات العصبية",
                    "خبرة في التعلم العميق"
                ],
                cyber: [
                    "فهم أساسيات الأمن السيبراني",
                    "معرفة جيدة بأمن الشبكات",
                    "مهارات في الاختراق الأخلاقي",
                    "خبرة في تشفير البيانات",
                    "قدرة على مواجهة التهديدات المتقدمة"
                ]
            };
            
            const allWeaknesses = {
                web: [
                    "تحتاج إلى تحسين في HTML المتقدم",
                    "CSS المتقدم يحتاج إلى تدريب",
                    "JavaScript المتقدم يحتاج إلى ممارسة",
                    "تحتاج إلى تعلم إطارات عمل إضافية",
                    "برمجة الخادم تحتاج إلى تعمق"
                ],
                ai: [
                    "تحتاج إلى تعمق في نظريات الذكاء الاصطناعي",
                    "بايثون المتقدم يحتاج إلى تحسين",
                    "خوارزميات التعلم الآلي المعقدة تحتاج إلى فهم أفضل",
                    "الشبكات العصبية المتقدمة تحتاج إلى دراسة",
                    "التعلم العميق يحتاج إلى ممارسة إضافية"
                ],
                cyber: [
                    "تحتاج إلى تعمق في نظريات الأمن",
                    "أمن الشبكات المتقدم يحتاج إلى دراسة",
                    "الاختراق الأخلاقي المتقدم يحتاج إلى تدريب",
                    "تشفير البيانات المتقدم يحتاج إلى فهم أعمق",
                    "التهديدات المتقدمة تحتاج إلى استراتيجيات أفضل"
                ]
            };
            
            // تحديد عدد نقاط القوة والضعف بناءً على مستوى القدرة
            const strengthCount = Math.max(1, Math.floor(ability * 3));
            const weaknessCount = Math.max(1, Math.floor((1 - ability) * 3));
            
            return {
                strengths: allStrengths[track].slice(0, strengthCount),
                weaknesses: allWeaknesses[track].slice(0, weaknessCount)
            };
        }
        
        // عرض تفاصيل التقييم
        async function viewAssessmentDetails(sessionId) {
            try {
                if (!currentUser) {
                    const savedUser = localStorage.getItem('currentUser');
                    if (savedUser) {
                        currentUser = JSON.parse(savedUser);
                    }
                }
                
                if (currentUser && currentUser.learningProfile.assessmentHistory) {
                    const assessment = currentUser.learningProfile.assessmentHistory.find(
                        a => a.sessionId === sessionId
                    );
                    
                    if (assessment) {
                        alert(`تفاصيل التقييم:\nالمسار: ${getTrackName(assessment.track)}\nالنتيجة: ${assessment.correctAnswers}/${assessment.totalQuestions}\nمستوى القدرة: ${(assessment.finalAbility * 100).toFixed(1)}%\nالمستوى الموصى به: ${assessment.recommendedLevel}`);
                    }
                }
            } catch (error) {
                console.error('Error loading assessment details:', error);
            }
        }
        
        // عرض التوصيات من صفحة النتائج
        function viewRecommendations() {
            showPage('recommendations');
            loadRecommendations();
        }
        
        // تسجيل الخروج
        function logout() {
            currentUser = null;
            currentSession = null;
            localStorage.removeItem('currentUser');
            showPage('login');
        }
        
        // وظائف مساعدة
        function getTrackName(trackCode) {
            const tracks = {
                'web': 'تطوير الويب',
                'ai': 'الذكاء الاصطناعي',
                'cyber': 'الأمن السيبراني',
                'data': 'علم البيانات',
                'mobile': 'تطوير الموبايل',
                'devops': 'DevOps'
            };
            return tracks[trackCode] || trackCode;
        }
        
        // التحقق من وجود مستخدم عند تحميل الصفحة
        window.addEventListener('load', () => {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showPage('home');
                loadUserData();
            } else {
                showPage('login');
            }
        });
    </script>
</body>
</html>